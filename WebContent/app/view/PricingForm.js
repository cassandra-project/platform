/*
 * File: app/view/PricingForm.js
 *
 * This file was generated by Sencha Architect version 2.1.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('C.view.PricingForm', {
	extend: 'Ext.form.Panel',

	padding: 5,
	autoScroll: true,
	layout: {
		type: 'auto'
	},
	bodyPadding: '10px',
	closable: false,

	initComponent: function() {
		var me = this;

		Ext.applyIf(me, {
			items: [
				{
					xtype: 'fieldset',
					title: 'Properties',
					items: [
						{
							xtype: 'textfield',
							width: 246,
							name: 'name',
							fieldLabel: 'Name',
							listeners: {
								change: {
									fn: me.onTextfieldChange11,
									scope: me
								}
							}
						},
						{
							xtype: 'combobox',
							width: 246,
							name: 'type',
							fieldLabel: 'Type <span style=color:red>*</span>',
							allowBlank: false,
							displayField: 'pricingTypeName',
							queryMode: 'local',
							store: 'PricingTypeStore',
							valueField: 'pricingTypeTag',
							listeners: {
								change: {
									fn: me.onComboboxChange,
									scope: me
								}
							}
						},
						{
							xtype: 'textareafield',
							width: 246,
							name: 'description',
							fieldLabel: 'Description'
						},
						{
							xtype: 'numberfield',
							width: 246,
							name: 'billingCycle',
							readOnly: false,
							fieldLabel: 'Billing Cycle',
							allowDecimals: false
						},
						{
							xtype: 'numberfield',
							width: 246,
							name: 'fixedCharge',
							readOnly: false,
							fieldLabel: 'Fixed Charge'
						}
					]
				},
				{
					xtype: 'fieldset',
					hidden: false,
					itemId: 'ScalarEnergyPricing',
					layout: {
						type: 'auto'
					},
					title: 'Extra Parameters',
					items: [
						{
							xtype: 'gridpanel',
							title: 'Levels',
							forceFit: false,
							store: 'LevelsStore',
							viewConfig: {
								minHeight: 70
							},
							columns: [
								{
									xtype: 'numbercolumn',
									dataIndex: 'price',
									text: 'Price',
									editor: {
										xtype: 'numberfield'
									}
								},
								{
									xtype: 'numbercolumn',
									dataIndex: 'level',
									text: 'Level',
									editor: {
										xtype: 'numberfield'
									}
								}
							],
							dockedItems: [
								{
									xtype: 'toolbar',
									dock: 'top',
									width: 508,
									items: [
										{
											xtype: 'button',
											text: 'New',
											listeners: {
												click: {
													fn: me.onButtonClick2,
													scope: me
												}
											}
										},
										{
											xtype: 'button',
											text: 'Delete',
											listeners: {
												click: {
													fn: me.onButtonClick12,
													scope: me
												}
											}
										}
									]
								}
							],
							plugins: [
								Ext.create('Ext.grid.plugin.RowEditing', {
									ptype: 'rowediting',
									clicksToMoveEditor: 1
								})
							]
						}
					]
				},
				{
					xtype: 'fieldset',
					hidden: true,
					itemId: 'ScalarEnergyPricingTimeZones',
					title: 'Extra Parameters',
					items: [
						{
							xtype: 'gridpanel',
							title: 'Levels',
							store: 'LevelsStore',
							viewConfig: {
								minHeight: 70
							},
							columns: [
								{
									xtype: 'numbercolumn',
									dataIndex: 'price',
									text: 'Price',
									editor: {
										xtype: 'numberfield'
									}
								},
								{
									xtype: 'numbercolumn',
									dataIndex: 'level',
									text: 'Level',
									editor: {
										xtype: 'numberfield'
									}
								}
							],
							dockedItems: [
								{
									xtype: 'toolbar',
									dock: 'top',
									width: 508,
									items: [
										{
											xtype: 'button',
											text: 'New',
											listeners: {
												click: {
													fn: me.onButtonClick21,
													scope: me
												}
											}
										},
										{
											xtype: 'button',
											text: 'Delete',
											listeners: {
												click: {
													fn: me.onButtonClick121,
													scope: me
												}
											}
										}
									]
								}
							],
							plugins: [
								Ext.create('Ext.grid.plugin.RowEditing', {
									ptype: 'rowediting',
									clicksToMoveEditor: 1
								})
							]
						},
						{
							xtype: 'gridpanel',
							title: 'Offpeak',
							store: 'OffpickStore',
							viewConfig: {
								minHeight: 70
							},
							dockedItems: [
								{
									xtype: 'toolbar',
									dock: 'top',
									width: 508,
									items: [
										{
											xtype: 'button',
											text: 'New',
											listeners: {
												click: {
													fn: me.onButtonClick211,
													scope: me
												}
											}
										},
										{
											xtype: 'button',
											text: 'Delete',
											listeners: {
												click: {
													fn: me.onButtonClick1211,
													scope: me
												}
											}
										}
									]
								}
							],
							plugins: [
								Ext.create('Ext.grid.plugin.RowEditing', {
									ptype: 'rowediting',
									clicksToMoveEditor: 1
								})
							],
							columns: [
								{
									xtype: 'numbercolumn',
									dataIndex: 'from',
									text: 'From',
									editor: {
										xtype: 'numberfield'
									}
								},
								{
									xtype: 'numbercolumn',
									dataIndex: 'to',
									text: 'To',
									editor: {
										xtype: 'numberfield'
									}
								}
							]
						}
					]
				},
				{
					xtype: 'fieldset',
					hidden: true,
					itemId: 'EnergyPowerPricing',
					layout: {
						align: 'stretch',
						type: 'hbox'
					},
					title: 'Extra Parameters',
					items: [
						{
							xtype: 'numberfield',
							width: 200,
							name: 'contractedCapacity',
							fieldLabel: 'Contracted Capacity',
							labelWidth: 60,
							allowDecimals: false
						},
						{
							xtype: 'numberfield',
							width: 200,
							name: 'energyPrice',
							fieldLabel: 'Energy Price',
							labelWidth: 60
						},
						{
							xtype: 'numberfield',
							width: 200,
							name: 'powerPrice',
							fieldLabel: 'Power Price',
							labelWidth: 60
						}
					]
				},
				{
					xtype: 'fieldset',
					hidden: true,
					itemId: 'AllInclusivePricing',
					layout: {
						align: 'stretch',
						type: 'hbox'
					},
					title: 'Extra Parameters',
					items: [
						{
							xtype: 'numberfield',
							width: 200,
							name: 'contractedEnergy',
							fieldLabel: 'Contracted Energy',
							labelWidth: 60,
							allowDecimals: false
						},
						{
							xtype: 'numberfield',
							width: 200,
							name: 'fixedCost',
							fieldLabel: 'Fixed Cost',
							labelWidth: 60
						},
						{
							xtype: 'numberfield',
							width: 200,
							name: 'additionalCost',
							fieldLabel: 'Additional Cost',
							labelWidth: 60
						}
					]
				},
				{
					xtype: 'button',
					itemId: 'btn',
					margin: '10px 120px',
					width: 70,
					text: 'Update',
					listeners: {
						click: {
							fn: me.onButtonClick1,
							scope: me
						}
					}
				}
			]
		});

		me.callParent(arguments);
	},

	onTextfieldChange11: function(field, newValue, oldValue, options) {
		this.setTitle(newValue);
		this.form.getRecord().node.set({'name':newValue});
	},

	onComboboxChange: function(field, newValue, oldValue, options) {
		Ext.each(this.items.items, function(item, index){
			if (index > 0 && item.xtype != 'button')
			item.hide();
		});

		this.getComponent(newValue).show();
	},

	onButtonClick2: function(button, e, options) {

		this.query('grid')[0].store.insert(0, {price:0, level : 0});
		this.query('grid')[0].plugins[0].startEdit(0, 0);




	},

	onButtonClick12: function(button, e, options) {
		console.info('Delete clicked.', this, button, e, options);

		var selections = this.query('grid')[0].getView().getSelectionModel().getSelection();
		this.query('grid')[0].store.remove(selections);

	},

	onButtonClick21: function(button, e, options) {

		this.query('grid')[1].store.insert(0, {price:0, level : 0});
		this.query('grid')[1].plugins[0].startEdit(0, 0);




	},

	onButtonClick121: function(button, e, options) {
		console.info('Delete clicked.', this, button, e, options);

		var selections = this.query('grid')[1].getView().getSelectionModel().getSelection();
		this.query('grid')[1].store.remove(selections);

	},

	onButtonClick211: function(button, e, options) {

		this.query('grid')[2].store.insert(0, {price:0, level : 0});
		this.query('grid')[2].plugins[0].startEdit(0, 0);




	},

	onButtonClick1211: function(button, e, options) {
		console.info('Delete clicked.', this, button, e, options);

		var selections = this.query('grid')[2].getView().getSelectionModel().getSelection();
		this.query('grid')[2].store.remove(selections);

	},

	onButtonClick1: function(button, e, options) {
		var levels = [];
		var offpeak = []; 
		var levelsData = [];
		var myForm = this.getForm();
		var record = myForm.getRecord();
		var values = myForm.getValues();

		if (record.get('type') == 'ScalarEnergyPricing') {
			levelsData = this.query('grid')[0].store.data;
			Ext.each(levelsData.items, function(index){
				levels.push(index.data);
			});
		}
		else if (record.get('type') == 'ScalarEnergyPricingTimeZones') {
			levelsData = this.query('grid')[1].store.data;
			Ext.each(levelsData.items, function(index){
				levels.push(index.data);
			});
			var offpeakData =  this.query('grid')[2].store.data;
			Ext.each(offpeakData.items, function(index){
				offpeak.push(index.data);
			});
		}

		record.set({
			'name' : values.name,
			'type' : values.type,
			'description' : values.description,
			'billingCycle' : values.billingCycle,
			'fixedCharge' : values.fixedCharge,
			'levels' : levels,
			'offpeak' : offpeak,
			'contractedCapacity' : (record.get('type') == 'EnergyPowerPricing') ? values.contractedCapacity : 0,
			'energyPrice' : (record.get('type') == 'EnergyPowerPricing') ? values.energyPrice : 0,
			'powerPrice' : (record.get('type') == 'EnergyPowerPricing') ? values.powerPrice : 0,
			'contractedEnergy' : (record.get('type') == 'AllInclusivePricing') ? values.contractedEnergy : 0,
			'fixedCost' : (record.get('type') == 'AllInclusivePricing') ? values.fixedCost : 0,
			'additionalCost' : (record.get('type') == 'AllInclusivePricing') ? values.additionalCost : 0
		});

		this.dirtyForm = false;
		//clear dirty record
		record.node.commit();

		if (record.isNew)
		record.isNew = false;
		//record.save();
	}

});